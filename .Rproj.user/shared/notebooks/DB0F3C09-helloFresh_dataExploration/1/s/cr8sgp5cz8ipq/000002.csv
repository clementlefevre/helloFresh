"0","percentile.97<-quantile(df.orders$number_orders,probs = .97)"
"0","df.orders.sequence<-df.per.CustomerID.InvoiceID %>% filter(order_sequence<percentile.97  ) %>% spread(order_sequence,TotalValue)"
"0","df.orders.sequence<-df.orders.sequence %>%"
"0","  group_by(CustomerID) %>%"
"0","  summarise_each(funs(ifelse(sum(is.na(.)==FALSE)==0, NA, .[which(is.na(.)==FALSE)])), matches(""[1-9]""))"
"0","colnames(df.orders.sequence) <- paste(""order"", colnames(df.orders.sequence), sep = ""_"")"
"0","names(df.orders.sequence)[names(df.orders.sequence) == 'order_CustomerID'] <- 'CustomerID'"
"0","df.orders.sequence <- df.orders.sequence %>%"
"0","      mutate_each(funs(replace(., is.na(.), 0)), -CustomerID)"
"0","df.orders.sequence <- df.orders.sequence %>% mutate_each(funs(log(.+1)),-CustomerID)"
