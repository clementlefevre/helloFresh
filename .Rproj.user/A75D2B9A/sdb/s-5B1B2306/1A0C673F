{
    "collab_server" : "",
    "contents" : "---\ntitle: \"French elections _ Cartograms\"\noutput: html_notebook\n---\n\n\n\n```{r}\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(stringr)\n```\n\n# Create a data frame with results aggregated per Departement :\n```{r}\ndf<-read.csv('data/DOI/Presidentielle_2017_Resultats_Communes_Tour_1_no_arrondissements75_13_69.csv', stringsAsFactors = FALSE)\nstr(df)\n```\n\nClean the mess with the votes results (the score are ranked per columns !!!)\n\n```{r}\ncolos_Exp<-grep('X..Voix.Exp',colnames(df),value = T)\ncolos_name<-grep('Nom',colnames(df),value = T)\ncolos_Voix<-grep('^Voix',colnames(df),value = T)\n\n\nfiltered_df_pres<-df %>% select_(.dots = c(colos_Exp,colos_name,colos_Voix,\"Code.de.la.commune\", \"Libellé.de.la.commune\",\"Code.du.département\",\"Libellé.du.département\",\"Votants\",\"Inscrits\",\"Abstentions\" ,\"Exprimés\",\"X..Abs.Ins\",\"X..Exp.Vot\"))\n\ngather_name<-filtered_df_pres %>% gather(key,'Nom',starts_with('Nom')) \ngather_scores<- filtered_df_pres%>% gather(key,'Score',starts_with('X..Voix.Exp'))\ngather_voix<- filtered_df_pres%>% gather(key,'Voix',starts_with('Voix'))\n\n\ngather_name_scores<- data.frame(select(gather_scores, Score), select(gather_name,Nom,Code.de.la.commune, Libellé.de.la.commune,Code.du.département,Libellé.du.département,Votants,Inscrits,Abstentions,Exprimés,X..Abs.Ins,X..Exp.Vot),select(gather_voix,Voix))\n\ndf_votes.2017<-gather_name_scores\n\n#ggplot(df_votes.2017,aes(x=Nom,y=Score, col=Nom))+ geom_boxplot()\n\n```\n\n```{r}\ndf_votes.2017 %>% filter(Code.du.département==73  &  grepl(\"Peis\",Libellé.de.la.commune))\n```\n\ntop LE PEN :\n```{r}\ndf_votes.2017 %>% filter(Nom=='LE PEN' & Code.du.département==75)  %>% arrange(desc(Votants))\n```\n\nSpread candidate names :\n```{r}\ndf_votes.2017<- df_votes.2017   %>% group_by(Code.du.département,Libellé.du.département,\n                                       Code.de.la.commune,Libellé.de.la.commune,Nom,Votants,Inscrits,Abstentions,Exprimés,X..Abs.Ins,X..Exp.Vot) %>% summarise(Sum_Voix=sum(Voix)) %>% spread(Nom,Sum_Voix)\nfilter(df_votes.2017,grepl('Vichy',Libellé.de.la.commune)& Code.du.département==3)\n\n```\n\n\n```{r}\nnames(df_votes.2017)[names(df_votes.2017) == \"LE PEN\"] <- \"LE.PEN\"\nnames(df_votes.2017)[names(df_votes.2017) == \"DUPONT-AIGNAN\"] <- \"DUPONT.AIGNAN\"\n\ncandidats<-c(\"ARTHAUD\",\"ASSELINEAU\",\"CHEMINADE\",\"DUPONT.AIGNAN\", \"FILLON\",\"HAMON\",\"LASSALLE\",\"LE.PEN\",\"MACRON\",\"MÉLENCHON\",\"POUTOU\")\n\ngroupy_departement<- df_votes.2017 %>% group_by(Code.du.département)  %>% summarise_at(c(candidats,\"Exprimés\"),funs(total_voix=sum(.), ratio_voix=sum(.)/sum(Exprimés)))\nwrite.csv(groupy_departement,'data/DOI/pres_1erTour_2017_par_departement_candidat.csv')\nView(groupy_departement)\n```\n\n",
    "created" : 1498044683263.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3087694512",
    "id" : "1A0C673F",
    "lastKnownWriteTime" : 1494573540,
    "last_content_update" : 1494573540,
    "path" : "~/workspace/france_elections/elections_france_aggregation_per_departement.Rmd",
    "project_path" : null,
    "properties" : {
        "chunk_output_type" : "inline"
    },
    "relative_order" : 8,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}